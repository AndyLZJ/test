<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>新增调研页面</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
		<link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
		<link rel="stylesheet" href="__PUBLIC__/layer/skin/layer.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		<!-- daterange picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/daterangepicker/daterangepicker.css">
		<!-- bootstrap datepicker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/datepicker/datepicker3.css">
		<!-- iCheck for checkboxes and radio inputs -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		<!-- Bootstrap Color Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/colorpicker/bootstrap-colorpicker.min.css">
		<!-- Bootstrap time Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/timepicker/bootstrap-timepicker.min.css">
		<!-- Select2 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/select2/select2.min.css">
    <!--三期时间插件样式-->
   		<link rel="stylesheet" href="__PUBLIC__/Dist/js/My97DatePicker/skin/default/datepicker.css">
		<link rel="stylesheet" href="__PUBLIC__/Css/selectUser.css">

	</head>

	<body>
		<!--内容区域顶栏面包屑开始-->
		<section class="content-header">
			<h1 class="info_title">
                            调研管理
        <small>/新增调研</small>
      </h1>
			<ol class="breadcrumb">
				<li>
					<a href="javascript:void(0)" onclick="JavaScript:history.back(-1)"><i class="fa fa-mail-reply-all"></i>返回</a>
				</li>
			</ol>
		</section>
		<!--内容区域顶栏面包屑结束-->
		<section class="content">
			<div class="box">
				<div class="box-body">
					<div id="example1_wrapper" class="dataTables_wrapper form-inline dt-bootstrap ">

						<div class="box-header with-border">
							<h3 class="box-title ">新增调研</h3>
						</div>
						<form class="form-horizontal" action="{:U('Research/editor')}" method="post" enctype="multipart/form-data">
							<div class="box-body">
								<!--项目名称字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label"><span class="color_red">*</span>调研名称：</label>

									<div class="col-sm-10">
										<input type="text" class="form-control mr30" id="inputEmail3" placeholder="" maxlength="40" name="research_name" value="{$data.research_name}" style="width:360px;" >
									</div>
								</div>
								<!--项目名称字段结束-->
								<!--培训班字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label"><span class="color_red">*</span>添加调研问卷：</label>

									<div class="col-sm-10">
										<a onclick="add_diaoyan();" class="btn btn-success form-group_but" ><i class="fa fa-plus mr5 "  aria-hidden="true "></i><span  id="wenjuan"><if condition="empty($id)">添加问卷<else/>修改问卷</if></span></a>
										<span class="ml10 text-bold text-blue" id="dqdy">{$data.survey_name}</span>
									</div>
								</div>
								<!--培训班字段结束-->
								<!--项目名称字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label"><span class="color_red">*</span>调研时间：</label>

									<div class="col-sm-10">
										<div class="input-group date">
											<div class="input-group-addon">
												<i class="fa fa-calendar"></i>
											</div>
											<input name="start_time" type="text" id="datebut" class="form-control pull-right"  value="{$data.start_time}" readonly="readonly" onclick="WdatePicker({dateFmt:'yyyy-MM-dd H:mm:ss',isShowClear:false,readOnly:false})">
										</div> 至
										<div class="input-group date">
											<div class="input-group-addon">
												<i class="fa fa-calendar"></i>
											</div>
											<input name="end_time" type="text" id="datainps" class="form-control pull-right" value="{$data.end_time}" readonly="readonly" onclick="WdatePicker({dateFmt:'yyyy-MM-dd H:mm:ss',isShowClear:false,readOnly:false})">
										</div>
									</div>
								</div>
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label"> <span class="color_red">*</span>指定部门：</label>
									<div class="col-sm-10">
										<a onclick="move_org();" class="btn btn-info form-group_but">指定部门</a>
									</div>
								</div>
								<div class="form-group">
									<label for="" class="col-sm-2 control-label"></label>
									<div class="col-sm-10">
										<div class="plus-tag tagbtn clearfix" id="myTags">
											<foreach name="ids" item="v" key='k'>
	                                            <a value='{$v}' title='{$names[$k]}' href="javascript:void(0);" />
	                                                <span>{$names[$k]}</span>
	                                                <em class="myTags">
	                                                    <input type="hidden" name="tissue_id[]" value="{$v}" />
	                                                </em>
	                                            </a>
	                                        </foreach>
										</div>
									</div>
								</div>
							</div>
							<div class="box-footer">
								<div class="form-group">
									<label class="col-sm-2 control-label"></label>
									<div class="col-sm-10">
										<div class="col-sm-6">
											<a class="btn btn-info form-group_but" id="submit">提交</a>
										</div>
									</div>
								</div>
							</div>
							<input type="hidden" name="survey_id" value="{$data.survey_id}"/>
							<input type="hidden" name="id" value="{$id}" />
							{__TOKEN__}
						</form>
						<!--内容結束-->
					</div>
				</div>
			</div>
		</section>
		<!--添加调研窗口结束-->
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
		<script src="__PUBLIC__/Js/js/date/jedate/jedate.js"></script>
		<script src="__PUBLIC__/Js/js/bootstrap.min.js"></script>
		<script src="__PUBLIC__/plugins/fastclick/fastclick.js"></script>
		<script src="__PUBLIC__/Dist/js/app.min.js"></script>
		<script src="__PUBLIC__/plugins/sparkline/jquery.sparkline.min.js"></script>
		<script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
		<script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
		<script src="__PUBLIC__/plugins/slimScroll/jquery.slimscroll.min.js"></script>
		<script src="__PUBLIC__/plugins/chartjs/Chart.min.js"></script>
		<script src="__PUBLIC__/Dist/js/pages/dashboard2.js"></script>
		<script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
		<script src="__PUBLIC__/plugins/layer/layer.js"></script>
		<script src="__PUBLIC__/Js/js/selectUser.js"></script>

		<!--三期时间插件js-->
		<script src="__PUBLIC__/Dist/js/My97DatePicker/WdatePicker.js"></script>

		<script type="text/javascript">
			//radio选中样式			
			$('input').iCheck({
				labelHover: false,
				cursor: true,
				checkboxClass: 'icheckbox_square-blue',
				radioClass: 'icheckbox_minimal-blue',
				increaseArea: '20%'
			});


			//指定部门
			function move_org(){
				layer.open({
					title: '指定部门',
					btn: ['确定','取消'],
					yes: function (index, layero){
						var body = layer.getChildFrame('body',index);
						var user_name = new Array();
						var user_id = new Array();
						body.find("input:checked").each(function(i){
							user_name = $(this).attr("alt");
							user_id = $(this).val();
							
							setTips(user_name,user_id);
						});
						layer.closeAll();
					},
					area: ['700px', '500px'],
					type: 2,
					skin: 'layui-layer-lan', //样式类名
					closeBtn: 1, //显示关闭按钮
					anim: 2,
					shadeClose: true, //开启遮罩关闭
					content: "{:U('Jurisdiction/authority',array('typeid'=>2),'',true)}"
				});

			}

			//添加调研
			function add_diaoyan(){
				layer.open({
					title: '添加调研',
					btn: ['确定', '取消'],
					yes: function (index, layero) {
						var body = layer.getChildFrame('body', index);

						var survey_id = body.find("input[name='survey']:checked").val();

						var survey_name = body.find("input[name='survey']:checked").attr("alt");

						if (typeof(survey_id) == "undefined") {

							layer.alert("请至少勾选一门调研");
							return;

						}else{

							$("input[name='survey_id']").val(survey_id);

							$("#dqdy").html(survey_name);
							$("#wenjuan").html("修改问卷");
							layer.closeAll();
						}
					},
					area: ['700px', '500px'],
					type: 2,
					skin: 'layui-layer-lan', //样式类名
					closeBtn: 1, //显示关闭按钮
					anim: 2,
					shadeClose: true, //开启遮罩关闭
					content: "{:U('PjCourse/research',array('typeid'=>1),'',true)}"
				});
			}

			$("#submit").click(function(){

				var research_name= $("input[name='research_name']").val();
				var start_time= $("input[name='start_time']").val();
				var end_time= $("input[name='end_time']").val();
				var survey_id= $("input[name='survey_id']").val();
				var tissue_id= $("input[name='user_id[]']").val();

				project_start_time = Date.parse(start_time);
				project_end_time = Date.parse(end_time);

				if(research_name.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g, '').length == 0){
					layer.alert("请填写调研名称");
					return;
				}else if(survey_id == ""){
					layer.alert("请添加问卷");
					return;
				}else if(start_time == ""){
					layer.alert("请选择开始时间");
					return;
				}else if(end_time == ""){
					layer.alert("请选择结束时间");
					return;
				}else if(project_start_time > project_end_time){

					layer.msg('开始时间不能大于结束时间', {
						time: 2000, //2s后自动关闭
					});

					return false;

				}else if(tissue_id == undefined){
					layer.alert("请选择指定部门");
					return;
				}

				$("form").submit();

			});


		</script>
	</body>

</html>