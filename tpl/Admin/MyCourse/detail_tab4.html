<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>课程详情_笔记</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
		<link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/layer/skin/layer.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/Mycourse.css">
		<!-- video player -->
		<link rel="stylesheet" href="__PUBLIC__/videoPlayer/video-js.css">
		<style type="text/css">
			.course_img{height:100%; }
			body,fieldset,legend,button,input,textarea{margin:0; padding:0; border:0; outline:0}
			a:hover,a:visited,a:link,a:active{text-decoration:none}
			sup{vertical-align:text-top}
			sub{vertical-align:text-bottom}
			legend{color:#000}
			fieldset,img{border:0}
			button,input,select,textarea{font-size:100%}
			table{border-collapse:collapse; border-spacing:0}
			.clear{clear:both; float:none; height:0; overflow:hidden}
			#pn{height:auto; background:#fff; margin:0 auto; padding:20px; padding-top:0}
			.list0{padding:20px 0; position:relative; border-top:1px solid #eee}
			.head{width:60px; float:left}
			.head img{width:60px; height:60px; border-radius:50%}
			.close{width:20px; height:20px; position:absolute; top:0; right:0; color:#696e78; font-size:14px; text-align:center; line-height:20px}
			.close:hover{color:#eb7350}
			.HF_content{line-height:20px; font-size:14px; margin-left:70px}
			.name{color:#eb7350}
			.pic{margin:5px 0}
			.good:after{clear:both; content:''; display:block; width:0; height:0; visibility:hidden}
			.good{*zoom:1; margin-top:5px}
			.date{float:left; color:#808080}
			.good a{float:right; color:#808080}
			.people{background:#f7f7f7; height:28px; line-height:28px; padding-left:10px; margin:5px 0}
			.comment:after{clear:both; content:''; display:block; width:0; height:0; visibility:hidden}
			.comment{*zoom:1; padding:10px 0; border-top:1px solid #eee}
			.comment-left{width:30px; float:left; display:inline; margin-right:10px}
			.comment-left img{width:30px; height:30px; border-radius:50%; border:1px solid #e0dddd; padding:2px}
			.comment-text{line-height:18px}
			.comment-text span{color:#eb7350}
			.comment-date{font-size:12px; line-height:14px; color:#ccc; position:relative}
			.comment-zan{position:absolute; right:95px; bottom:0; color:#808080}
			.comment-dele{position:absolute; right:0; bottom:0; color:#808080}
			.hf:after{clear:both; content:''; display:block; width:0; height:0; visibility:hidden}
			.hf{*zoom:1; margin-top:5px}
			.hf-text{border:1px solid #eee; display:block; height:35px; width:100%; padding:5px; resize:none; color:#ccc; font-size:12px}
			.hf-on .hf-text{height:60px; color:#333; border:1px solid #ff8140}
			.hf-btn{float:right; width:65px; height:26px; background:#f7f7f7; color:#ccc; font-size:12px; display:none}
			.hf-btn-on{background:#ff8140; color:#fff}
			.hf-nub{float:right; padding:3px 5px; color:#666; display:none}
			.hf-on .hf-btn{display:inline}
			.hf-on .hf-nub{display:inline}
			.huifu{right:45px}
			.FBmap{margin:auto}
			.FBmap textarea{resize:none; border:1px solid #c7c3c3; width:100%; min-height:100px; font-size:15px; padding:10px; }
			.FBmap textarea:focus{border:1px solid #66AFE9; }
			.FBbtn{float:right; color:white; cursor:pointer; height:35px; width:75px; margin-top:-5px; background-color:orangered}
			.course_cover{padding:1px; margin:0; width:706px; height:406px; border:2px solid #ccc;}
			.kejianFullScreen{position: absolute; right: 20px; margin-top: -35px; cursor:pointer; }
			.kejianSetFull{margin:0; border:0; padding:0; clear:both; position:fixed; right:0; top:0; left:0; bottom:0; z-index:99999; }
			
			/*课程问答*/
			.btn1{border: none; height: 2.0em; background-color: #3E8CD0; color: white; font-size: 1em; margin-top: 0.5em; width: 100%; border-radius: 0.5em; }
			.btn2{border: none; height: 2.0em; background-color: #e1e2e4; color: black; font-size: 1em; margin-top: 0.5em; width: 100%; border-radius: 0.5em; }
			.btn1:focus{outline: none; border: none; }
			.btn2:focus{outline: none; border: none; }
			.que_map{border: 1px solid #00acd6; padding: 0px 5px; border-radius: 5px; position: absolute; top: 0px; width: 100%; }
			.que_gundong{border: 1px solid #00acd6; padding: 0px 5px; border-radius: 5px; position: fixed; top: 0px; width: 32%; background:#fff; }
			.chap_string{padding:0 8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
			
		</style>
	</head>
	<body>
		<!--内容区域顶栏面包屑结束-->
		<section class="content">
			<div class="box-body">
				<div class="row">
					<if condition="$base.joinStatus eq 0">
						<p style="font-size:20px; color:#bbb; ">加入到我的课程后才可以写笔记哦~~</p>
					</if>
					
					<if condition="$base.joinStatus eq 1">
					<div class="course_note_editor FBmap">
							<textarea id="CentontBJ" placeholder="好记性不如小笔记，快来记下学习中的点滴………………"></textarea>
							<div style="height: 45px;">
								<button class="FBbtn" onclick="addNote()">添加笔记</button>
								<span class="float_r mr15 mt5" ><input class="is_public" type="checkbox" name="check" value="公开" /> <span class="ml5">公开</span> </span>
							</div>
						</div>
						<ul id="pnBJ">
							<foreach name="note" item="vo">
							<li class="list0">
								<input type="hidden" value="{$vo.id}" class="note_id">
								<if condition="$vo.del_status eq 1"><a class="close" href="javascript:;" style="opacity: 0.6;">X</a></if>
								<div class="head"><img src="{$vo.avatar}" onerror="this.src='__PUBLIC__/Dist/img/avatar5.png'"/></div>
								<div class="HF_content">
									<p class="text"><span class="name">{$vo.username}：</span>{$vo.note_content}</p>
									<div class="good"><span class="date">{$vo.time}</span>
									</div>
								</div>
							</li>
							</foreach>
						</ul>
					</if>
				</div>
			</div>
			<!--分页开始-->
			<div class="row">
				<div class="dataTables_paginate float_r mr15">
					<!-- 分页html -->
					{$pageNav}
				</div>
			</div>
			<!--分页结束	-->
		</section>
		<input type="hidden" id="joinStatus" value="{$base.joinStatus}"/>
		<input type="hidden" id="sub_comment_id" value=""/>
		<input type="hidden" id="newReplyId" value=""/>
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
		<script src="__PUBLIC__/Css/bootstrap/js/bootstrap.min.js"></script>
		<script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
		<script src="__PUBLIC__/plugins/layer/layer.js"></script>
		<script type="text/javascript">
			//radio选中样式
			$('input').iCheck({
				labelHover: false,
				cursor: true,
				checkboxClass: 'icheckbox_square-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '20%'
			});
			
			//获取当前时间
			function getTime() {
				var t = new Date();
				var y = t.getFullYear();
				var m = t.getMonth() + 1;
				var d = t.getDate();
				var h = t.getHours();
				var mi = t.getMinutes();
				m = m < 10 ? "0" + m : m;
				d = d < 10 ? "0" + d : d;
				h = h < 10 ? "0" + h : h;
				mi = mi < 10 ? "0" + mi : mi;
				return y + "-" + m + "-" + d + " " + h + ":" + mi;
			}
			
			//添加笔记
			function addNote() {
				var NOWTime = getTime();
				var UserName = "{$username}"; //用户名
				var Centont = $("#CentontBJ").val(); //发布内容
				Centont = $.trim(Centont);
				var avatar = "{$avatar}"; //图片路径
				var is_public = $(".is_public").is(':checked');
				
				var publicStatus = 1;
				if(!is_public){
					publicStatus = 2;
				}
				if(!Centont){
					layer.alert("请填写笔记内容");
					return false;
				}
				
				var _pnBJ = $("#pnBJ");
				var _CentontBJ = $("#CentontBJ");
				var _is_public = $(".is_public");
				var _icheckbox_square = $(".icheckbox_square-blue");
				$.ajax({
					type: "post",
					url: "__CONTROLLER__/addNote",
					data: "course_id={$course_id}&project_id={$project_id}&content="+encodeURIComponent(Centont)+"&is_public="+publicStatus,
					dataType: "json",
					success: function(data){
						if(data.code == 1000){
							var html = "<li class=\"list0\"><input type=\"hidden\" value=\""+data.last_id+"\" class=\"note_id\"><a class=\"close\" href=\"javascript:;\" style=\"opacity: 0.6;\">X</a><div class=\"head\"><img src=\"" + avatar + "\" onerror=\"this.src='__PUBLIC__/Dist/img/avatar5.png'\"/></div><div class=\"HF_content\"><p class=\"text\"><span class=\"name\">" + UserName + "：</span>" + Centont + "</p><div class=\"pic\"></div><div class=\"good\"><span class=\"date\">" + NOWTime + "</span></div></div></li>";
							_pnBJ.prepend(html);
							_CentontBJ.val("");//笔记发布后自动清空
							_is_public.attr('checked',false);
							_icheckbox_square.removeClass('checked');
							
							parent.iFrameHeight();//操作父级方法 重新设置iframe高度
						}else{
							layer.alert(data.message);
						}
					}
				});
			}
			
			if($("#joinStatus").val() == "0"){
				$(".dzan").remove();
				$(".comment-dele").remove();
				$(".hf-text").remove();
			}
			
			//删除笔记
			$("#pnBJ").on("click",".close",function(){
				var note_id = $(this).closest("li").find(".note_id").val();
				if(!note_id){
					layer.alert("未获取到笔记id");
					return false;
				}
				layer.confirm("是否删除该笔记？");
				var note_con = $(this).closest("li");
				$(".layui-layer-btn0").click(function(){
					$.ajax({
						type: "post",
						url: "__CONTROLLER__/delNote",
						data: "note_id="+note_id,
						dataType: "json",
						success: function(data){
							if(data.code == 1000){
								note_con.remove();
							}else{
								layer.alert(data.message);
							}
						}
					});
				});
			});
		</script>
	</body>
</html>