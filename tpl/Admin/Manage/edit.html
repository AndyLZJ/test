<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>前台添加培训项目</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
		<link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/layer/skin/layer.css">
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		<!-- daterange picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/daterangepicker/daterangepicker.css">
		<!-- bootstrap datepicker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/datepicker/datepicker3.css">
		<!-- iCheck for checkboxes and radio inputs -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		<!-- Bootstrap Color Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/colorpicker/bootstrap-colorpicker.min.css">
		<!-- Bootstrap time Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/timepicker/bootstrap-timepicker.min.css">
		<!-- Select2 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/select2/select2.min.css">

		<link rel="stylesheet" href="__PUBLIC__/Css/selectUser.css">
			
	</head>

	<body>
		<!--内容区域顶栏面包屑开始-->
		<section class="content-header">
			<h1 class="info_title">
        培训项目
        <small>/新建培训项目</small>
      </h1>
			<ol class="breadcrumb">
				<li>
					<a href="javascript:void(0)" onclick="JavaScript:history.back(-1)"><i class="fa fa-mail-reply-all"></i>返回</a>
				</li>
			</ol>
		</section>
		<!--内容区域顶栏面包屑结束-->
		<section class="content">
			<div class="box">
				<div class="box-body">
					<div id="example1_wrapper" class="dataTables_wrapper form-inline dt-bootstrap ">

						<div class="box-header with-border">
							<h3 class="box-title ">新建培训项目</h3>
						</div>
						<form class="form-horizontal" action="{:U('Admin/Manage/refresh',array())}" method="post" enctype="multipart/form-data">
							<div class="box-body">
								<!--项目名称字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label">项目名称<span class="color_red">*</span>：</label>

									<div class="col-sm-10">
										<input name="project_name" type="text" class="form-control mr30" id="inputEmail3" placeholder="" value="{$project.project_name}" required>
										<input name="project_id" type="hidden" class="form-control mr30" id="inputEmail3" placeholder="" value="{$project.id}" >
									</div>
								</div>
								<!--项目名称字段结束-->
								<!--培训班字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label">培训班名称：</label>

									<div class="col-sm-10">
										<input name="class_name" type="text" class="form-control mr30" id="" placeholder="" value="{$project.class_name}" required>
									</div>
								</div>
								<!--培训班字段结束-->

								<!--项目名称字段开始-->
								<div class="form-group" id="supplier" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label">项目时间：</label>

									<div class="col-sm-10">
										<div class="input-group date">
											<div class="input-group-addon">
												<i class="fa fa-calendar" onClick="jeDate({dateCell:'#datebut',isTime:true,format:'YYYY-MM-DD hh:mm:ss'})"></i>
											</div>
											<input name="start_time" type="text" id="datebut" class="form-control pull-right" id="datepicker" value="{$project.start_time}" required>
										</div> 至
										<div class="input-group date">
											<div class="input-group-addon">
												<i class="fa fa-calendar" onClick="jeDate({dateCell:'#datainps',isTime:true,format:'YYYY-MM-DD hh:mm:ss'})"></i>
											</div>
											<input name="end_time" type="text" id="datainps" class="form-control pull-right" id="datepicker" value="{$project.end_time}" required>
										</div>

									</div>
								</div>
								<!--项目名称字段结束-->
								<!--项目描述字段开始-->
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">项目描述：</label>
									<div class="col-sm-10">
										<!--编辑器开始-->
										<textarea name="project_description" id="TextArea1" cols="20" rows="2" class="ckeditor" required>{$project.project_description}</textarea>
										<!--编辑器结束-->
									</div>
								</div>
								<!--项目描述字段结束-->
								<!--封面上传字段开始-->
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">项目封面：</label>

									<div class="col-sm-10">
										<assign name="project_covers" value="$project.project_covers" />
										<div class="box box-success certificate_img"  <empty name="project_covers">style="display:none"</empty>>
										<div class="box-tools pull-right">
											<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
										</div>
										<div class="box-body">
											<img id="image" src="{$project.project_covers}" alt="课件预览" width="100%">
										</div>
									</div>
									<input type="hidden" name="filename" value="{$project.project_covers}" id="filename"/>
									<input type="file" class="btn btn-primary" id="file" name="file">
									<span class="ml10">(支持：gif、jpg、jpeg、bmp、png格式　建议尺寸：220px*124px)</span>
								</div>

								</div>
								<!--封面上传字段结束-->
								<!--制作人字段开始-->
								<!-- <div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">项目预算：</label>
									<div class="col-sm-10">
										<input type="number" name="project_budget" class="form-control mr10" id="inputEmail3" placeholder="0" value="{$project.project_budget}" required>元
									</div>
								</div> -->
								<div class="form-group">
								<label for="inputEmail3" class="col-sm-2 control-label">项目预算<span class="color_red">*</span>：</label>
								<div class="col-sm-10">
									<table class="table table-bordered table-striped dataTable text-center">
										<thead><th width="280" class="text-center">费用名称</th>
											<th  class="text-center">费用预算(元)</th>
											<th class="text-center">操作</th></thead>
								<tbody>
									<foreach name="name" item="v" key="k">
									<if condition="in_array($v,array('内部讲师费','外部讲师费','课程开发费','外部培训费','培训咨询费','培训器材费','场地费','食宿费','交通差旅费','其他费用',))">
										<tr>
											<td style="position: relative;">
												<div style="position:relative;">
													<span class="HBinput">
														<select class="form-control select2 width_10"  onchange="this.parentNode.nextSibling.value=this.value;check_name();">
														<option value="内部讲师费" <if condition="$v eq '内部讲师费'">selected</if>>内部讲师费</option>
														<option value="外部讲师费" <if condition="$v eq '外部讲师费'">selected</if>>外部讲师费</option>
														<option value="课程开发费" <if condition="$v eq '课程开发费'">selected</if>>课程开发费</option>
														<option value="外部培训费" <if condition="$v eq '外部培训费'">selected</if>>外部培训费</option>
														<option value="培训咨询费" <if condition="$v eq '培训咨询费'">selected</if>>培训咨询费</option>
														<option value="培训器材费" <if condition="$v eq '培训器材费'">selected</if>>培训器材费</option>
														<option value="场地费" <if condition="$v eq '场地费'">selected</if>>场地费</option>
														<option value="食宿费" <if condition="$v eq '食宿费'">selected</if>>食宿费</option>
														<option value="交通差旅费" <if condition="$v eq '交通差旅费'">selected</if>>交通差旅费</option>
														<option value="其他费用" <if condition="$v eq '其他费用'">selected</if>>其他费用</option>
														</select></span><input name="box[]" style="width:90%;position:absolute;left:0px;" class="form-control boxs" placeholder="输入或下拉选择" value="{$v}" maxlength="20"  onblur="check_name();"/>
												</div>
											</td>
											<td>
												<input type="number" name="amount[]" class="form-control width_10 text-center numbers" min="0.1" onblur="up();" value="{$amount[$k]}" step="0.1" max="9999999999"/>
											</td>
											<td>
												<a onclick="del(this);" href="javascript:void(0);" class="bs-callout-info text-danger del">
													<i class="fa fa-trash-o mr5" aria-hidden="true"></i>删除
												</a>
											</td>
										</tr>
									<else/>
										<tr>
											<td style="position: relative;">
												<div style="position:relative;">
													<span class="HBinput">
														<select class="form-control select2 width_10"  onchange="this.parentNode.nextSibling.value=this.value;check_name();" >
														<option value="{$v}" >{$v}</option>
														<option value="内部讲师费" >内部讲师费</option>
														<option value="外部讲师费" >外部讲师费</option>
														<option value="课程开发费" >课程开发费</option>
														<option value="外部培训费" >外部培训费</option>
														<option value="培训咨询费" >培训咨询费</option>
														<option value="培训器材费" >培训器材费</option>
														<option value="场地费" >场地费</option>
														<option value="食宿费" >食宿费</option>
														<option value="交通差旅费" >交通差旅费</option>
														<option value="其他费用" >其他费用</option>
														</select></span><input name="box[]" style="width:90%;position:absolute;left:0px;" class="form-control boxs" placeholder="输入或下拉选择" value="{$v}" maxlength="20"  onblur="check_name();"/>
												</div>
											</td>
											<td>
												<input type="number" name="amount[]" class="form-control width_10 text-center numbers" min="0.1" onblur="up();" value="{$amount[$k]}" step="0.1" max="9999999999"/>
											</td>
											<td>
												<a onclick="del(this);" href="javascript:void(0);" class="bs-callout-info text-danger del">
													<i class="fa fa-trash-o mr5" aria-hidden="true"></i>删除
												</a>
											</td>
										</tr>
									</if>
									</foreach>
								</tbody>
									<tfoot>
										<tr>
											<td style="position: relative;">合计</td>
											<td class="total">{$project.project_budget|default=0}</td>
											<input type="hidden" name="project_budget" id="project_budget" value="{$project.project_budget|default=0}"/>
											<td>
												<a onclick="add_html()" href="javascript:void(0);" class="bs-callout-info text-success">
													<i class="fa fa fa-plus mr5" aria-hidden="true"></i>新增费用
												</a>
											</td>
										</tr>
									</tfoot>
									</table>
								</div>
							</div>
								<!--制作人字段结束-->
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">指定人员：</label>
									<div class="col-sm-10">
										<div class="plus-tag tagbtn clearfix" id="myTags">
											<foreach name="dpersonnels" item="vo" >
												<a  value='{$vo.id}' title='{$vo.username}' href="javascript:void(0);" /><span>{$vo.username}</span><em class="myTags"><input type="hidden"  name="user_id[]" value="{$vo.id}" /></em></a>
											</foreach>
										</div>
										<button class="btn btn-primary form-group_but preview" type="button" onclick="move_org()" id="preview">指定人员</button>
									</div>
								</div>

								<!--章节添加字段结束-->
								<div class="form-group" id="address" style="display: none;">
									<label for="inputEmail3" class="col-sm-2 control-label">公开报名：</label>
									<div class="col-sm-10">
										<input name="is_public" type="checkbox" value="1" <if condition="$project['is_public'] eq 1">checked="checked"</if>/> <span class="ml20 ">
												<button class="btn btn-primary form-group_but preview" type="button" onclick="open_range()">公开范围</button></span>
										<div class="plus-tag tagbtn clearfix "  style="margin-top: 10px" id="open">
											<foreach name="department" item="vo" >
												<a  value='{$vo.id}' title='{$vo.name}' href="javascript:void(0);" /><span>{$vo.name}</span><em class="open"><input type="hidden"  name="tissue_id[]" value="{$vo.id}" /></em></a>
											</foreach>
										</div>

									</div>
								</div>
							<div class="box-footer">
								<div class="form-group">
									<label class="col-sm-2 control-label"></label>
									<div class="col-sm-10">
										<div class="col-sm-6">
											<button type="submit" class="btn btn-default form-group_but">下一步</button>
										</div>
										<div class="col-sm-6">
											<a class="btn btn-default form-group_but" href="{:U('Admin/Manage/draught',array('id'=>$project['id']))}">存为草稿</a>
										</div>
									</div>
								</div>
							</div>
						</form>
						<!--内容結束-->
					</div>
				</div>
			</div>
		</section>
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
		<script src="__PUBLIC__/Js/js/date/jedate/jedate.js"></script>
		<script src="__PUBLIC__/Js/js/selectUser.js"></script>
		<script src="__PUBLIC__/Js/js/startScore.js"></script>
		<script src="__PUBLIC__/Js/js/photo.js"></script>
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
		<script src="__PUBLIC__/Js/js/js/bootstrap.min.js"></script>
		<script src="__PUBLIC__/plugins/fastclick/fastclick.js"></script>
		<script src="__PUBLIC__/Dist/js/app.min.js"></script>
		<script src="__PUBLIC__/plugins/sparkline/jquery.sparkline.min.js"></script>
		<script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
		<script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
		<script src="__PUBLIC__/plugins/slimScroll/jquery.slimscroll.min.js"></script>
		<script src="__PUBLIC__/plugins/chartjs/Chart.min.js"></script>
		<script src="__PUBLIC__/Dist/js/pages/dashboard2.js"></script>
		<script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
		<script src="__PUBLIC__/plugins/ckeditor/ckeditor.js"></script>
		<script src="__PUBLIC__/plugins/layer/layer.js"></script>
		<script src="__PUBLIC__/plugins/uploadify/jquery.uploadify.min.js"></script>
		<script type="text/javascript">
			//radio选中样式
			$("#file").uploadify({
				"swf": "__PUBLIC__/plugins/uploadify/uploadify.swf",
				"buttonClass":"btn btn-primary",
				"line-height":"15px",
				"height":"30px",
				"fileObjName": "download",
				"buttonText": "上传封面",
				"uploader": "{:U('File/upload')}",
				'removeTimeout': 1,
				"onUploadSuccess": function (file, data) {
					var url = JSON.parse(data);
					var src = url.src;
					var img_src = '__UPLOAD__/'+src;
					$('#filename').val(img_src);
					$("#image").attr("src",img_src);
					$(".certificate_img").removeAttr("style");
				},
				'onFallback': function () {
					alert('未检测到兼容版本的Flash.');
				}
			});

			function checkDate(start,end){
				if(start == '' || end == ''){
					alert('项目起止时间不能为空');
					return false;
				}
				var startTime = new Date(start);
				var endTime = new Date(end);
				var yusuan = $('#inputEmail3').val();
				if(startTime.getTime() >= endTime.getTime()){
					alert('项目开始时间不能早于结束时间');
					return false;
				}else if( yusuan ==''){
					alert('项目预算不能为空');
					return false;
				}else{
					return true;
				}
			}

			$("#continue").click(function(){
				var start =	$("#datebut").val();
				var end =	$("#datainps").val();
				if(!checkDate(start,end)){
					return false;
				}

				$("input[name='post_type']").val(1);
				$("input[name='typeid']").val(2);
			})

			$("#draft").click(function(){
				var start =	$("#datebut").val();
				var end =	$("#datainps").val();
				if(!checkDate(start,end)){
					return false;
				}

				$("input[name='post_type']").val(2);
				$("input[name='typeid']").val(1);
			})

			//指定部门
			function move_org() {

				layer.open({
					title: '指定人员',
					btn: ['确定','取消'],
					yes: function (index, layero) {
						var body = layer.getChildFrame('body', index);

						var user_name = new Array();

						var user_id = new Array();

						body.find("input[type='checkbox']:checked").each(function(i){

							user_name = $(this).attr("alt");

							user_id = $(this).val();

							setTips(user_name,user_id);
						});

						layer.closeAll();

					},
					area: ['700px', '500px'],
					type: 2,
					skin: 'layui-layer-lan', //样式类名
					closeBtn: 1, //显示关闭按钮
					anim: 2,
					shadeClose: true, //开启遮罩关闭
					content: "{:U('Manage/personnel','','',true)}"
				});

			}


			//公开范围
			function open_range(){

				var is_public = $("input[name='is_public']:checked").val();

				if(is_public == 1){
					layer.open({
						title: '公开范围',
						btn: ['确定','取消'],
						yes: function (index, layero) {

							var body = layer.getChildFrame('body', index);

							var user_name = new Array();

							var user_id = new Array();

							body.find("input[type='checkbox']:checked").each(function(i){

								user_name = $(this).attr("alt");

								user_id = $(this).val();

								OpenTips(user_name,user_id);
							});

							layer.closeAll();

						},
						area: ['700px', '500px'],
						type: 2,
						skin: 'layui-layer-lan', //样式类名
						closeBtn: 1, //显示关闭按钮
						anim: 2,
						shadeClose: true, //开启遮罩关闭
						content: "{:U('Manage/department','','',true)}"
					});

				}else{

					layer.msg('请勾选公开报名!');

				}

			}
		</script>
	</body>

</html>