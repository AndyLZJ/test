<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>积分中心</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		 <link rel="stylesheet" href="__PUBLIC__/plugins/layer/skin/layer.css">
	     <link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
         <link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
         <link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
         <link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
         <link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
         <link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
         <link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
         <link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
		 <link rel="stylesheet" href="__PUBLIC__/plugins/datepicker/bootstrap-datetimepicker.css">
		 		<style type="text/css">
			.ulitem {
				padding: 10px;
				border: 1px #dcdcdc solid;
			}
			.ulitem img{
				width: 100%;
			}



			.ulitem:hover {
				border: 1px #0288d1 solid;
				box-shadow: 0 1px 3px rgba(3, 169, 244, .45);
			}
			
			.course_img {
				position: relative;
			}
			
			.course_time {
				padding: 7px;
				background-color: rgba(0, 0, 0, 0.5);
				z-index: 9999999;
				color: #fff;
				position: absolute;
				right: 0px;
				left: 0px;
				bottom: 0px;
			}
			
			.integral_stati {
				display: block;
				margin: 0 auto;
				border: 16px solid #fff;
				width: 138px;
				height: 138px;
				border-radius: 50%;
				color: #fff;
				font-size: 1.6rem;
				box-shadow: 0 1px 8px rgba(0, 0, 0, .2);
				line-height: 110px;
				overflow: hidden;
				cursor: default;
			}
			
			.jifenbt {
				cursor: pointer;
				background-color: #46bbdf;
				width: 205px;
				text-align: center;
				margin: auto;
				color: white;
				border-radius: 5px;
			}
		
			.form-control:focus {
				border-color: #46bbdf;
				box-shadow: none;
			}
			
			.fuli_name {
				font-size: 24px;
			}
			
			.text-gray {
				color: #7b7777!important;
			}
			
.form-control:focus {
    border-color: #46bbdf;
    box-shadow: none;
}
		</style>
	</head>
	<body>
		<!--内容区域顶栏面包屑开始-->
		<section class="content-header">
			<h1 class="info_title">
        个人中心
        <small>/我的积分</small>
     </h1>
			
		</section>
		<!--内容区域顶栏面包屑结束-->
		<section class="content">
			 <div class="info_box mt15">
	             <div class="box-header with-border info_box_title">
	               <a class="btn btn-primary btn-sm mr10 float_r" href="{:U('Admin/Integration/myintegrationWater')}">
	                   <i class="mr5 fa fa-navicon"></i>积分流水
	               </a>
	               <!--<a class="btn btn-primary btn-sm mr10 float_r" href="{:U('Admin/Integration/myintegrationApply')}">
	                   <i class="mr5 fa fa-calendar-plus-o"></i>申请加积分
	               </a>-->
	               <a class="btn btn-primary btn-sm mr10 float_r" href="{:U('Admin/Integration/myintegrationRule')}">
	                   <i class="mr5 fa fa-calendar-minus-o"></i>积分规则
	               </a>
				   <div class="col-sm-10">
						<select id="selectyear" style="width:200px" name="user_id" class="form-control form-control">
							<option value=""><a>--选择年份--</a> </option>
                                    <foreach name="yeardata" item="vo">
									<option value="{$vo}">{$vo}</option>
                                    </foreach>
						</select>
						<input type="text" id="text2" style="display:none" name="name" class="form-control"  value="{$detail.name}" placeholder="">
                    </div>
	             </div>
	             <div class="box-body">
					 <!--年度总积分-->
	                <div class="col-sm-4 text-center mt10"> 
                         <span id="all_score" class="integral_stati" style="background:#71d6d0;">{$all_score}</span> 
                         <div class="mt10">总积分</div>
	                </div>
					<!--年度可用积分-->
	                <div class="col-sm-4 text-center mt10"> 
                         <span id="available_score" class="integral_stati" style="background:#8bc34a;">{$available_score}</span> 
                         <div class="mt10">可用积分</div>
	                </div>
	                <div class="col-sm-4 text-center mt10">
						<span id="currentMonth" class="integral_stati" style="background:#46bbdf;">{$this_month_score}</span>
						<div class="mt10">本月积分
							<div class="text-center">
								<!--<input type="button" class="form-control jifenbt " value="本月积分▼" id="datepicker">-->
								 <div class="col-sm-10">
                                        <select id="selectmonth" style="width:200px;float:right" name="user_id" class="form-control form-control">
                                            <option value=""><a>--选择月份--</a> </option>
											<option value="01">1月</option>
											<option value="02">2月</option>
											<option value="03">3月</option>
											<option value="04">4月</option>
											<option value="05">5月</option>
											<option value="06">6月</option>
											<option value="07">7月</option>
											<option value="08">8月</option>
											<option value="09">9月</option>
											<option value="10">10月</option>
											<option value="11">11月</option>
											<option value="12">12月</option>      
                                        </select>
                                        <input type="text" id="text2" style="display:none" name="name" class="form-control"  value="{$detail.name}" placeholder="">
                                </div>
							</div>
						</div>
					</div>
	             </div>    
	         </div>
	         <div  class="mt15">
	             <div class="box-header with-border info_box_title mt5">
	               <span style="font-size: 22px;">福利社</span>
	             </div>
	             <div class="box-body">
					 
                    
				   <!--<foreach name="list" item="v">
	                <div class="col-sm-2 mb20">
						<div class="ulitem">
							<div class="course_img">
								<img src="{$v.welfare_covers}"  onerror="this.src='__PUBLIC__/Dist/img/fuli.png'">
								<div class="course_time">
									<spn id="welfare_score" class="color_red">{$v.need_score}</spn>积分
								</div>
							</div>
							<div class="box-title mt5 row">
								<label class="col-sm-12 "><h4><a id="welfare_name">{$v.name}</a></h4></label>
							</div>
						
							<div class="mt5">
								<a class="btn btn-success" style="width: 100%;" onclick="exchange('{$v.name}','{$v.need_score}')">兑换</a>
							</div>
						</div>	
					</div>
				   </foreach>-->
				
	               <foreach name="list" item="v">
				    <div class="col-sm-12 mt20">
					<div class="box-header with-border">
						<div class="pull-left  mr15">
							<div class="ulitem">
								<div class="course_img">
									<img width="100%"  src="{$v.welfare_covers}"  onerror="this.src='__PUBLIC__/Dist/img/fuli.png'">
									<div class="course_time">
										<spn class="color_red">{$v.need_score}</spn>积分
									</div>
								</div>
							</div>
						</div>
						<div class="">
							<div class="fuli_name">
								{$v.name}
								<a class="btn btn-success pull-right" onclick="exchange('{$v.name}','{$v.need_score}')">兑换福利</a>
							</div>
							<p class="text-gray mt10">
								{$v.welfare_describe|re_substr=###,0,420}
							</p>
						</div>
					</div>
				   </div>  
                   </foreach>
				</div>


	         </div>
		</section>
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="__PUBLIC__/Js/js/bootstrap.min.js"></script>
        <script src="__PUBLIC__/plugins/fastclick/fastclick.js"></script>
        <script src="__PUBLIC__/Dist/js/app.min.js"></script>
        <script src="__PUBLIC__/plugins/sparkline/jquery.sparkline.min.js"></script>
        <script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <script src="__PUBLIC__/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <script src="__PUBLIC__/plugins/chartjs/Chart.min.js"></script>
        <!--<script src="__PUBLIC__/Dist/js/pages/dashboard2.js"></script>-->
        <script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
        <script src="__PUBLIC__/Dist/js/demo.js"></script>
        <script src="__PUBLIC__/plugins/ckeditor/ckeditor.js"></script>
        <script src="__PUBLIC__/Dist/js/demo.js"></script>
        <script src="__PUBLIC__/plugins/layer/layer.js"></script>
		<script src="__PUBLIC__/plugins/datepicker/bootstrap-datetimepicker.js"></script>
		<script type="text/javascript">
			

			function exchange(a,b) {
				//删除分组
				// alert(a);
				// alert(b);
				//  exit;
				var name = a;
				var need_score = b;
				var tit = "pc";
				layer.confirm("您确认使用<span class='color_red'>"+need_score+"</span>积分兑换<span class='color_red'>" +name+ "</span>吗？", 
				
				{  
					btn: ['兑换', '取消'],
					skin: 'layui-layer-lan'
						//按钮
				}, function() {
					 $.post("{:U('Admin/Integration/myintegrationExchange')}",{name:name,need_score:need_score}, function($data) {  
                        
                          if($data.status == 1){
							 layer.msg($data.info, {time: 1500,icon: 1});
                              setTimeout(function(){
                               location.href = "{:U('Admin/Integration/myintegration',array('tabType'=>1))}";
                              },1000);   
                          }else{  
							//    layer.msg($data.info, { time: 1000});
                            //    location.href = $data.url; 
                            layer.msg($data.info, {icon: 2});
                          }     
                      },'json');

					// layer.msg('兑换成功', {time: 1500,icon: 1});
                    
				}, function() {
					layer.msg('已取消兑换', {
						time: 2000, //2s后自动关闭
					});
				});
			}
		
			$.fn.datetimepicker.dates['zh'] = {
				days: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"],
				daysShort: ["日", "一", "二", "三", "四", "五", "六", "日"],
				daysMin: ["日", "一", "二", "三", "四", "五", "六", "日"],
				months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
				monthsShort: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
				meridiem: ["上午", "下午"],
				//suffix:      ["st", "nd", "rd", "th"],  
				today: "本月"
			};

			$(function() {
				
				$('#datepicker').datetimepicker({
					language: 'zh',
					format: 'yyyy-mm',
					weekStart: 1,
					todayBtn: 1,
					autoclose: 1,
					todayHighlight: 1,
					startView: 3, //这里就设置了默认视图为年视图
					minView: 3, //设置最小视图为年视图
					forceParse: 0,
					autoclose: true,
                    todayBtn: true,
                    startDate: "2017-01-01 00:00",
					
				});

				//年份选择器
                $('#selectyear').change(function(){
					var year = $('#selectyear').val();
					var months = $('#selectmonth').val();
                    $.post("{:U('Admin/Integration/myintegration')}",{'months':months,'year':year}, function($data) {  
                          
                          if($data.status == 1){
							  
							  $('#all_score').text($data.info.all_score);
							  $('#available_score').text($data.info.available_score);
							  $('#currentMonth').text($data.info.this_month_score);
                          }else{  
                            layer.msg($data.info, {icon: 2});
                          }     
                      },'json');
				});

				//月份选择器
				$('#selectmonth').change(function(){
					var year = $('#selectyear').val();
					
					var months = $('#selectmonth').val();
					// location.href = '{:U('Admin/Integration/myintegration')}'+'?months='+months; 
                    $.post("{:U('Admin/Integration/myintegration')}",{'months':months,'year':year}, function($data) {  
                          
                          if($data.status == 1){
							//   alert($data.info.all_score);
							//   alert($data.info.available_score);
							//   alert($data.info.this_month_score);
							  $('#currentMonth').text($data.info.this_month_score);
                          }else{  
                            layer.msg($data.info, {icon: 2});
                          }     
                      },'json');

					console.log($('#selectmonth').val());
				});
           
			});
		</script>
	</body>

</html>