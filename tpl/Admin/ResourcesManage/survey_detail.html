<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>资源管理_新建问卷</title>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
<link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
<link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
<link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="__PUBLIC__/plugins/layer/skin/layer.css">
<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
<!-- 图片预览插件 -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/plugins/dropify-v0.2.2/css/dropify.min.css"/>

<style type="text/css">
a {
	color: #337ab7;
}

a:hover,a:active,a:focus {
	outline: none;
	text-decoration: none;
	color: #03A9F4;
}
.itemOrder{
	font-size:20px; font-weight:700; color:#777; 
    border-top: 2px dashed #ddd;
    margin:30px 0 0 30px;
    padding-top:15px;
}

.optImg, .itemImg{
	display:none; 
	width:200px; height:150px; 
}
.dropify-wrapper{width:200px; height:150px; }
.text-gray{color:#777 !important;}
</style>
</head>
<body>
	<!--内容区域顶栏面包屑开始-->
	<section class="content-header">
		<h1 class="info_title">
			资源管理 <small>/问卷管理</small> <small>/新建问卷</small>
		</h1>
		<ol class="breadcrumb">
			<li><a href="javascript:history.go(-1);"><i class="fa fa-mail-reply-all"></i>返回</a></li>
		</ol>
	</section>
	<!--内容区域顶栏面包屑结束-->
	<section class="content">
		<div class="box">
			<div class="box-body">
				<div id="example1_wrapper" class="dataTables_wrapper form-inline dt-bootstrap ">
					<div class="box-header with-border">
						<div class="row">
							<div class="dataTables_filter">
								<button type="button" class="btn btn-info mr20">
									<i class="fa fa-gears mr5 " aria-hidden="true "></i>预设表单
								</button>
								<button type="button" class="btn btn-success mr20 addChoose">
									<i class="fa fa-plus mr5 " aria-hidden="true "></i>新增选择题
								</button>
								<button type="button" class="btn btn-info addFill">
									<i class="fa fa-plus mr5 " aria-hidden="true "></i>新增填空题
								</button>
								<button type="button" class="btn btn-warning  float_r ">
									<i class="fa fa-close mr5 " aria-hidden="true "></i>取消
								</button>
								<button type="button" class="btn btn-info mr20  float_r ">
									<i class="fa fa-paper-plane-o mr5 " aria-hidden="true "></i>保存并发布
								</button>
								<button type="button" class="btn btn-success mr20  float_r ">
									<i class="fa fa-paper-plane-o mr5 " aria-hidden="true "></i>保存问卷
								</button>

							</div>
						</div>
					</div>
					<form class="form-horizontal">
						<div class="box-body">
							<div class=" form-group mt10">
								<label class="col-sm-2 control-label"><span class="color_red">*</span>分类：{$survey.survey_cat_id}</label>
								<div class="col-sm-3">
									<select class="form-control select2 width_10">
										<option value="">--请选择分类--</option>
										<foreach name="cats" item="v">
										<option value="{$v.id}"
											<if condition="$v['id'] eq $survey['survey_cat_id']"> selected="seleceted" </if>
											>{$v.cat_name}
										</option>
										</foreach>
									</select>
								</div>
							</div>
							<div class=" form-group">
								<label class="col-sm-2 control-label"><span class="color_red">*</span>标题：</label>
								<div class="col-sm-10">
									<input style="width: 300px;" type="text" class="form-control mr30"  placeholder="请输入标题" value="{$survey.survey_name}">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label"><span class="color_red">*</span>简介：</label>
								<div class="col-sm-6">
									<textarea class="form-control width_10" rows="4" placeholder="请输入简介  ...">{$survey.survey_desc}</textarea>
								</div>
							</div>
							<div class="itemList">
								
							
							</div>
						</div>
						
						<div class="form-group mt20">
							<label class="col-sm-2 control-label"></label>
							<div class="col-sm-6">
								<button type="button" class="btn btn-success mr20 addChoose">
									<i class="fa fa-plus mr5 " aria-hidden="true "></i>新增选择题
								</button>
								<button type="button" class="btn btn-info addFill">
									<i class="fa fa-plus mr5 " aria-hidden="true "></i>新增填空题
								</button>
								<button type="button" class="btn btn-info ml20 saveForm">
									<i class="fa mr5 " aria-hidden="true "></i>提交审核
								</button>
							</div>
						</div>
					</form>
					<!--内容結束-->
				</div>
			</div>
		</div>
	</section>
	
	<!-- 新增选择题   style="display:none;" -->
	<div id="addChooseHtml" style="display:none;">
		<div class="itemCon">
			<form action="" method="post">
			<p class="itemOrder">第1题</p>
			<div class="form-group">
				<label class="col-sm-2 control-label"><span class="color_red">*</span>题目：</label>
				<div class="col-sm-6">
					<textarea class="form-control width_10" rows="4" name="title" placeholder="请输入标题/题干  ..."></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">插图：</label>
				<div class="col-sm-6">
					<label class="mt5"><a href="javascript:void(0)" class="chooseItemImg">选择图片</a></label>
					<div class="itemImg">
						<input type="file" name="img" class="dropify">
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">必填：</label>
				<div class="col-sm-6">
					<div class="mt5">
						<span class="mr15"><input class="mr5" type="radio" name="is_must" value="1" checked="checked"/> 是</span> 
						<input class="mr5" type="radio" name="is_must" value="2"  /> 否
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">选项：</label>
				<div class="col-sm-6">
					<div class="mt5">
						<span class="mr15"><input class="mr5" type="radio" name="classification" value="1" checked="checked" /> 单选</span> 
						<input class="mr5" type="radio" name="classification" value="2" /> 多选
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">类型：</label>
				<div class="col-sm-6">
					<div class="mt5">
						<span class="mr15"><input class="mr5" type="radio" name="item_type" value="2"  /> 普通</span> 
						<input class="mr5" type="radio" name="item_type" value="1" checked="checked"/> 投票 <span class="text-gray">（用户提交后对其显示总体选项分布情况）</span>
					</div>
				</div>
			</div>
			<div class="optList">
				<div class="form-group">
					<label class="col-sm-2 control-label"><span class="color_red">*</span>选项：</label>
					<div class="col-sm-10">
						<input style="width: 300px;" type="text" class="form-control mr30" name="option[]" placeholder="请输入选项文字">
						<label class="mt5"><a href="javascript:void(0)" class="chooseOptImg">选择图片</a></label>
						<span class="ml20">
							<a href="javascript:void(0)" class="optUp"><i class="fa fa-lg fa-arrow-circle-o-up mr10 " aria-hidden="true "></i></a>
							<a href="javascript:void(0)" class="optDown"><i class="fa fa-lg fa-arrow-circle-o-down mr10 " aria-hidden="true "></i></a>
							<a href="javascript:void(0)" class="optDel"><i class="fa fa-lg fa-minus-circle mr10 " aria-hidden="true "></i></a>
							<a href="javascript:void(0)" class="optAdd"><i class="fa fa-lg fa-plus-circle mr10 " aria-hidden="true "></i></a>
						</span>
						<div class="optImg">
							<input type="file" name="opt_img[]" class="dropify"/>
						</div>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">操作：</label>
				<div class="col-sm-6">
					<div class="text-left">
						<a class="btn btn-social-icon btn-info mr10 moveUp" title="上移"><i class="fa fa-caret-up"></i></a><!-- 上移 -->
						<a class="btn btn-social-icon btn-info mr10 moveDown" title="下移"><i class="fa fa-caret-down"></i></a><!-- 下移 -->
						<a class="btn btn-social-icon btn-google mr10 delItem" title="删除"><i class="fa fa-trash-o"></i></a><!-- 删除 -->
					</div>
				</div>
			</div>
			</form>
		</div>
	</div>
	
	<!-- 
	<a class="btn btn-social-icon btn-success mr10 copyItem"><i class="fa fa-copy"></i></a>
	<a class="btn btn-social-icon btn-success mr10 previewItem"><i class="fa fa-check"></i></a>
	<a class="btn btn-social-icon btn-dropbox mr10 editItem"><i class="fa fa-pencil-square-o"></i></a>
	 -->
	
	<!-- 新增填空题 -->
	<div id="addFillHtml" style="display:none;">
		<div class="form-group">
			<label class="col-sm-2 control-label"><span class="color_red">*</span>题目：</label>
			<div class="col-sm-6">
				<textarea class="form-control width_10" rows="4" name="title" placeholder="请输入标题/题干  ..."></textarea>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">插图：</label>
			<div class="col-sm-6">
				<label class="mt5"><a href="javascript:void(0)" class="chooseItemImg">选择图片</a></label>
				<div class="itemImg">
					<input type="file" name="img" class="dropify">
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">必填：</label>
			<div class="col-sm-6">
				<div class="mt5">
					<span class="mr15"><input class="mr5" type="radio" name="bitiantwo" value="" /> 是</span> <input class="mr5" type="radio" name="bitiantwo" value=""  /> 否 <span style="float: right;"> 验证：<select style="width: 130px;" class="form-control select2">
							<option selected="selected">无</option>
							<option>只允许整数</option>
							<option>只允许数字</option>
							<option>只允许英文字母</option>
							<option>只允许汉字</option>
							<option>固话</option>
							<option>邮件</option>
							<option>身份证号</option>
					</select></span>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label"><span class="color_red">*</span>回答：</label>
			<div class="col-sm-6">
				<textarea class="form-control width_10" rows="4" placeholder="可输入回答引导语  ..."></textarea>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">操作：</label>
			<div class="col-sm-6">
				<div class="text-left">
					<a class="btn btn-social-icon btn-info mr10 moveUp" title="上移"><i class="fa fa-caret-up"></i></a><!-- 上移 -->
					<a class="btn btn-social-icon btn-info mr10 moveDown" title="下移"><i class="fa fa-caret-down"></i></a><!-- 下移 -->
					<a class="btn btn-social-icon btn-google mr10 delItem" title="删除"><i class="fa fa-trash-o"></i></a><!-- 删除 -->
				</div>
			</div>
		</div>
	</div>
	
	<!-- 新增选项 -->
	<div id="addOptHtml" style="display:none;">
		<div class="form-group">
			<label class="col-sm-2 control-label"><span class="color_red">*</span>选项：</label>
			<div class="col-sm-10">
				<input style="width: 300px;" type="text" class="form-control mr30" name="option[]" placeholder="请输入选项文字">
				<label class="mt5"><a href="javascript:void(0)" class="chooseOptImg">选择图片</a></label>
				<span class="ml20">
					<a href="javascript:void(0)" class="optUp"><i class="fa fa-lg fa-arrow-circle-o-up mr10 " aria-hidden="true "></i></a>
					<a href="javascript:void(0)" class="optDown"><i class="fa fa-lg fa-arrow-circle-o-down mr10 " aria-hidden="true "></i></a>
					<a href="javascript:void(0)" class="optDel"><i class="fa fa-lg fa-minus-circle mr10 " aria-hidden="true "></i></a>
					<a href="javascript:void(0)" class="optAdd"><i class="fa fa-lg fa-plus-circle mr10 " aria-hidden="true "></i></a>
				</span>
				<div class="optImg">
					<input type="file" name="opt_img[]" class="dropify"/>
				</div>
			</div>
		</div>
	</div>
	
	<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
	<script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
	<script src="__PUBLIC__/Css/bootstrap/js/bootstrap.min.js"></script>
	<script src="__PUBLIC__/plugins/layer/layer.js"></script>
	<script type="text/javascript" src="__PUBLIC__/plugins/dropify-v0.2.2/js/dropify.min.js"></script>
	<script type="text/javascript">
		$(function(){
			//----------------选项操作部分-----------------
			//选项图片
			$(".itemList").on("click",".chooseOptImg",function(){
				$('.itemList .dropify').dropify({
	               messages: {
	                    default: '选择图片',
	                    replace: '点击更换图片',
	                    remove:  '删除图片'
	                }
	            });
				$(this).closest(".form-group").find(".dropify").click();
				$(this).closest(".form-group").find(".optImg").show();
			});
			
			//删除图片
			$(".itemList").on("click",".dropify-clear",function(){
            	$(this).closest(".optImg").hide();
            });
			
			//添加选项
			$(".itemList").on("click",".optAdd",function(){
            	var htmlCon = $("#addOptHtml").html();
            	$(this).closest(".itemCon").find(".optList").append(htmlCon);
            });
			
			//删除选项
			$(".itemList").on("click",".optDel",function(){
				var length = $(this).closest(".optList").find(".form-group").length;
				if(length == 1){
					layer.alert("至少保留一个选项");
					return false;
				}
            	$(this).closest(".form-group").remove();
            });
			
			//上移选项
			$(".itemList").on("click",".optUp",function(){
				var index = $(this).closest(".form-group").index();
				if(index == 0){
					return false;
				}
				var htmlCon = $(this).closest(".form-group");
				$(this).closest(".optList").find(".form-group").eq(index-1).before(htmlCon);
            });
			
			//下移选项
			$(".itemList").on("click",".optDown",function(){
				var index = $(this).closest(".form-group").index();
				var length = $(this).closest(".optList").find(".form-group").length;
				if(index == (length - 1)){
					return false;
				}
				var htmlCon = $(this).closest(".form-group");
				$(this).closest(".optList").find(".form-group").eq(index+1).after(htmlCon);
            });
			
			
			//----------------------------试题部分-----------------------
			//新增选择题
			$(".addChoose").click(function(){
				var htmlCon = $("#addChooseHtml").html();
				$(".itemList").append(htmlCon);
				
				$('.itemList input').iCheck({
					labelHover : false,
					cursor : true,
					checkboxClass : 'icheckbox_square-blue',
					radioClass : 'iradio_flat-blue',
					increaseArea : '20%'
				});
				orderSet();
			});
			
			//新增简答题
			$(".addFill").click(function(){
				var htmlCon = $("#addFillHtml").html();
				$(".itemList").append(htmlCon);
				
				$('.itemList input').iCheck({
					labelHover : false,
					cursor : true,
					checkboxClass : 'icheckbox_square-blue',
					radioClass : 'iradio_flat-blue',
					increaseArea : '20%'
				});
				orderSet();
			});
			
			//上移题目
			$(".itemList").on("click",".moveUp",function(){
				var index = $(this).closest(".itemCon").index();
				if(index == 0){
					return false;
				}
				var htmlCon = $(this).closest(".itemCon");
				$(".itemCon").eq(index-1).before(htmlCon);
				orderSet();
			});
			
			//下移题目
			$(".itemList").on("click",".moveDown",function(){
				var index = $(this).closest(".itemCon").index();
				var length = $(".itemList .itemCon").length;
				if(index == (length - 1)){
					return false;
				}
				var htmlCon = $(this).closest(".itemCon");
				$(".itemCon").eq(index+1).after(htmlCon);
				orderSet();
			});
			
			//选择图片
			$(".itemList").on("click",".chooseItemImg",function(){
				$('.itemList .itemImg .dropify').dropify({
		               messages: {
		                    default: '选择图片',
		                    replace: '点击更换图片',
		                    remove:  '删除图片'
		                }
		            });
				$(this).closest("div").find(".dropify").click();
				$(this).closest("div").find(".itemImg").show();
			});
			
			//预览
			$(".previewItem").on("click",function(){
				
			});
			
			//编辑
			$(".editItem").on("click",function(){
				
			});
			
			//复制
			$(".itemList").on("click",".copyItem",function(){
				var index = $(this).closest(".itemCon").index();
				var htmlCon = $(this).closest(".itemCon").html();
				//$(".itemCon").eq(index+1).after(htmlCon);
				var data = $(this).closest(".itemCon").find("form").serialize();
				$(".itemList").append(htmlCon);
				orderSet();
			});
			
			//删除
			$(".itemList").on("click",".delItem",function(){
				$(this).closest(".itemCon").remove();
			});
			
			//计算题目序号
			function orderSet(){
				$(".itemList .itemOrder").each(function(index,element){
					$(element).text("第"+(index+1)+"题");
				});
			}
		});
	</script>
</body>
</html>