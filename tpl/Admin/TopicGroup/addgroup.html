<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>个人中心——话题部落——创建部落</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	
		<link rel="stylesheet" href="__PUBLIC__/Dist/css/comm.css">
        <link rel="stylesheet" href="__PUBLIC__/Css/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Dist/font-awesome-4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Dist/ionicons-2.0.1/css/ionicons.min.css">
        <link rel="stylesheet" href="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
        <link rel="stylesheet"href="__PUBLIC__/Css/skins/comm.css">
        <link rel="stylesheet" href="__PUBLIC__/Dist/css/AdminLTE.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Dist/css/skins/_all-skins.min.css">
        <link rel="stylesheet"href="__PUBLIC__/plugins/layer/skin/layer.css">
        <link rel="stylesheet"href="__PUBLIC__/plugins/iCheck/all.css">
		<!-- daterange picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/daterangepicker/daterangepicker.css">
		<!-- bootstrap datepicker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/datepicker/datepicker3.css">
		<!-- iCheck for checkboxes and radio inputs -->
		<!-- Bootstrap Color Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/colorpicker/bootstrap-colorpicker.min.css">
		<!-- Bootstrap time Picker -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/timepicker/bootstrap-timepicker.min.css">
		<!-- Select2 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/select2/select2.min.css">
		<link rel="stylesheet" href="__PUBLIC__/Css/selectUser.css">
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/Huploadify.css"/>
	
		<style type="text/css">
			a {
				cursor: pointer;
				color: #337ab7;
			}
			
			a:hover {
				text-decoration: underline;
				color: #03A9F4;
			}
		</style>
		
	</head>

	<body>
		<!--内容区域顶栏面包屑开始-->
		<section class="content-header">
			<h1 class="info_title">
        个人中心
        <small>/部落</small>
        <small>/创建部落</small>
      </h1>
			<ol class="breadcrumb">
				<li>
					<a href="javascript:void(0)" onclick="history.back(-1)"><i class="fa fa-mail-reply-all"></i>返回</a>
				</li>
			</ol>
		</section>
		<!--内容区域顶栏面包屑结束-->
		<section class="content">
			<div class="box">
				<div class="box-body">
					<div id="example1_wrapper" class="dataTables_wrapper form-inline dt-bootstrap ">
						<div class="box-header with-border">
							<h3 class="box-title ">创建部落</h3>
						</div>
						<form action="{:U('Admin/TopicGroup/add')}" onsubmit="return form1ChK()" method="POST" class="form-horizontal">
							<div class="box-body">

								<div class=" form-group">
									<label for="inputEmail3" class="col-sm-2 control-label"><span class="color_red">*</span>部落名称：</label>
									<div class="col-sm-10">
										<input name="name" style="width: 300px;" type="text" class="form-control mr30" id="inputEmail3" placeholder="请输入部落名称">
									</div>
								</div>
								<div class="form-group">
									<label  for="inputEmail3" class="col-sm-2 control-label"><span class="color_red">*</span>部落主题：</label>
									<div class="col-sm-10">
										<!--编辑器开始-->
											<textarea id="theme" name="theme" cols="20" rows="2" class="ckeditor"></textarea>
											<!--编辑器结束-->
									</div>
								</div>
                                 <!--封面上传字段开始-->
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">封面图片：</label>
									<div class="col-sm-10">
										<assign name="welfare_covers" value="$data.welfare_covers" />
										<div class="box box-success certificate_img" >
											<div class="box-tools pull-right">
												<button type="button" onclick="a()" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
											</div>
											<div class="box-body">
												<img id="image"  alt="图片预览" width="100%">
											</div>
										</div>
										<input type="hidden" name="group_covers" id="filename"/>
											<div id="file" name="file"></div>
											<span class="ml10">(支持：gif、jpg、jpeg、png格式　建议尺寸：220px*124px)</span>
									</div>
								</div>
								<div class="form-group">
									<label for="inputEmail3" class="col-sm-2 control-label">邀请人员：</label>
									<div class="col-sm-10">
										已选定 <span class="text-blue number">{$designee_total|default=$user}</span>人
										<button class="btn btn-primary form-group_but preview" type="button" onclick="section_zhiding()">选择人员</button>
										<div class="plus-tag tagbtn clearfix" id="myTags">
											<foreach name="designee" item="vo" >
												<a value='{$vo.id}' title='{$vo.username}' href="javascript:void(0);"/><span>{$vo.username}</span><em class="myTags"><input type="hidden"  name="user_id[]" value="{$vo.id}" /></em></a>
											</foreach>
										</div>
									</div>
								</div>

							</div>
							<div class="box-footer">
								<div class="form-group">
										<div class="col-sm-12 text-center">
							
											<button type="submit" class="btn btn-info form-group_but">提交审核 </button>
										</div>
								
								</div>
							</div>
						</form>
						<!--内容結束-->
					</div>
				</div>
			</div>
		</section>
		<script src="__PUBLIC__/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="__PUBLIC__/Js/js/bootstrap.min.js"></script>
        <script src="__PUBLIC__/plugins/fastclick/fastclick.js"></script>
        <script src="__PUBLIC__/Dist/js/app.min.js"></script>
        <script src="__PUBLIC__/plugins/sparkline/jquery.sparkline.min.js"></script>
        <script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="__PUBLIC__/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <script src="__PUBLIC__/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <script src="__PUBLIC__/plugins/chartjs/Chart.min.js"></script>
		<script src="__PUBLIC__/Js/js/selectUser.js"></script>
        <script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
        <script src="__PUBLIC__/Dist/js/demo.js"></script>
        <script src="__PUBLIC__/plugins/ckeditor/ckeditor.js"></script>
        <script src="__PUBLIC__/plugins/layer/layer.js"></script>	
		<script  src="__PUBLIC__/uploadify/jquery.Huploadify.js"></script>
		<script type="text/javascript">
			//radio选中样式			
			$('input').iCheck({
				labelHover: false,
				cursor: true,
				checkboxClass: 'icheckbox_square-blue',
				radioClass: 'icheckbox_minimal-blue',
				increaseArea: '20%'
			});

			//选择指定人员
		function section_zhiding() {
			layer.open({
				title: '指定人员',
				yes: function (index, layero) {
					var body = layer.getChildFrame('body', index);

					var user_name = new Array();

					var user_id = new Array();

					body.find("input[type='checkbox']:checked").each(function(i){
						user_name = $(this).attr("alt");
						user_id = $(this).val();

						if(user_name == undefined){
							return true;
						}
						setTips(user_name,user_id);
					});

					layer.closeAll();

					$('.number').html($('#myTags a').length);
				},
				btn: ['保存','取消'],
				area: ['900px', '480px'],
				offset: ['20px'],
				type: 2,
				skin: 'layui-layer-lan', //样式类名
				closeBtn: 1, //显示关闭按钮
				anim: 2,
				shadeClose: true, //开启遮罩关闭
				content: "{:U('admin/tissue/designee','','',true)}"
			});
		}
        
		$("#file").Huploadify({
			buttonText:'选择文件',
			auto:true,
			method:'post',
			fileTypeExts:'*.doc;*.docx;*.jpg;*.png;*.gif;*.jpeg',
			multi:false,
			formData:{key:123456,key2:'news'}, //banner是图片存放的目录
			fileSizeLimit:10240,
			itemTemplate:'',//进度条，若显示进度条用 'itemTemp'
			showUploadedPercent:true,//是否实时显示上传的百分比，如20%
			showUploadedSize:true,
			removeTimeout:1000,
			uploader: "{:U('File/upload',array('typeid'=>2))}",

			onUploadSuccess: function (file, data) {
			
				var url = JSON.parse(data);
				var src = url.src;

				var img_src = '__UPLOAD__/'+src;
				$('#filename').attr('value',img_src);
				
				$('#Preview').html('<img id="image" src="{$data.attachment}" alt="图片预览" width="100%">');
				$("#image").attr("src",img_src);
				$(".certificate_img").removeAttr("style");
		
		   	 },
		   });
        //jq对CKEDITOR编辑器获取值
        CKEDITOR.replace( 'theme' );
		function getContenet(){
			return CKEDITOR.instances.theme.getData();    //获取textarea的值
		}

       function form1ChK(){
				//字段规则控制
		   var name = $(":input[name='name']").val();
		   var theme = getContenet();
		   var user_id = new Array()
            $(":input[name^='user_id']").each(function(i, o){
					user_id[i] = $(o).val();
					//  user_id.push($(o).val());   
				// 两种写法选一个就好
				});
		   var myuser_id = "{$Think.session.user.id}";
			if(name.length == 0){
				alert('部落名称必填');
				return false;
			}else if(name.length  > 30){
				alert('部落名称超过最大长度限制');
				return false;
			}else if(theme.length == 0){				
				alert('部落主题必填');
				return false;
			}else if(user_id.indexOf(myuser_id) > -1){
				alert('邀请人员不能包含自己');
				return false;
			}

	   }
        
		//方法二:使用正则替换所有中文字符,然后再计算
		function getBLen(str) {
		if (str == null) return 0;
		if (typeof str != "string"){
			str += "";
		}
		return str.replace(/[^\x00-\xff]/g,"ab").length;
		}


		function a() {
                 
				$('#filename').val(''); 
						
				$('#Preview').html('');

			}
		</script>
	</body>

</html>